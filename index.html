<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Diary with AI Prompts & Dark Mode</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/lucide@latest"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Sarabun:wght@300;400;600&display=swap');
        body { font-family: 'Sarabun', sans-serif; transition: 0.3s; }
        .dark { background-color: #0f172a; color: #f1f5f9; }
        .dark .bg-white { background-color: #1e293b; border-color: #334155; }
        .dark .bg-gray-50 { background-color: #334155; }
        .hidden { display: none; }
    </style>
</head>
<body class="bg-slate-50 text-slate-900">

    <nav class="bg-white border-b p-4 sticky top-0 z-50 dark:border-slate-700">
        <div class="container mx-auto flex justify-between items-center">
            <h1 class="text-xl font-bold text-blue-600 flex items-center gap-2 cursor-pointer" onclick="showCalendarView()">
                <i data-lucide="sparkles"></i> AI Diary
            </h1>
            <div class="flex items-center gap-4">
                <input type="text" id="searchTag" onkeyup="searchByTag()" placeholder="‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤ #..." class="hidden md:block px-4 py-1 border rounded-full text-sm dark:bg-slate-800 outline-none">
                <button onclick="toggleDarkMode()" class="p-2 rounded-full hover:bg-slate-100 dark:hover:bg-slate-700">
                    <i data-lucide="moon" id="darkIcon"></i>
                </button>
            </div>
        </div>
    </nav>

    <main class="container mx-auto px-4 mt-6">
        
        <div id="calendar-view" class="max-w-4xl mx-auto space-y-6">
            <div class="bg-white p-6 rounded-3xl shadow-sm border border-slate-200">
                <div class="flex justify-between items-center mb-6">
                    <button onclick="changeMonth(-1)" class="p-2 hover:bg-slate-50 rounded-lg"><i data-lucide="chevron-left"></i></button>
                    <h2 id="monthLabel" class="text-xl font-bold"></h2>
                    <button onclick="changeMonth(1)" class="p-2 hover:bg-slate-50 rounded-lg"><i data-lucide="chevron-right"></i></button>
                </div>
                <div id="calendarGrid" class="grid grid-cols-7 gap-2 text-center text-sm"></div>
            </div>
            
            <div class="bg-white p-6 rounded-3xl shadow-sm h-64 border border-slate-200">
                <canvas id="moodChart"></canvas>
            </div>
        </div>

        <div id="entry-view" class="hidden max-w-2xl mx-auto pb-20">
            <button onclick="showCalendarView()" class="mb-4 text-blue-500 flex items-center gap-2 font-semibold">
                <i data-lucide="chevron-left" class="w-5"></i> ‡∏Å‡∏•‡∏±‡∏ö‡πÑ‡∏õ‡∏´‡∏ô‡πâ‡∏≤‡∏õ‡∏è‡∏¥‡∏ó‡∏¥‡∏ô
            </button>
            
            <div class="bg-white p-8 rounded-[2rem] shadow-2xl space-y-6 border border-slate-100">
                <div class="bg-blue-50 dark:bg-blue-900/30 p-5 rounded-2xl border-l-4 border-blue-500">
                    <div class="flex items-center gap-2 text-blue-600 dark:text-blue-400 mb-2 font-bold text-sm">
                        <i data-lucide="brain-circuit" class="w-4"></i> AI WRITING PROMPT
                    </div>
                    <p id="aiQuestion" class="text-slate-700 dark:text-slate-200 font-medium"></p>
                </div>

                <h2 id="entryDateTitle" class="text-2xl font-bold text-slate-800 dark:text-white"></h2>

                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <div class="space-y-2">
                        <label class="text-xs font-bold text-slate-400 uppercase">‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û</label>
                        <div id="imagePreview" onclick="document.getElementById('fileInput').click()" class="aspect-video bg-slate-100 dark:bg-slate-700 rounded-2xl flex items-center justify-center overflow-hidden cursor-pointer border-2 border-dashed border-slate-300">
                            <i data-lucide="camera" class="text-slate-400"></i>
                        </div>
                        <input type="file" id="fileInput" accept="image/*" class="hidden" onchange="handleImage(event)">
                    </div>
                    <div class="space-y-2">
                        <label class="text-xs font-bold text-slate-400 uppercase">‡∏≠‡∏≤‡∏£‡∏°‡∏ì‡πå</label>
                        <div class="flex justify-between h-full items-center px-2" id="moodPicker">
                            <button onclick="setMood('happy')" id="m-happy" class="text-3xl grayscale hover:grayscale-0 transition">üòä</button>
                            <button onclick="setMood('neutral')" id="m-neutral" class="text-3xl grayscale hover:grayscale-0 transition">üòê</button>
                            <button onclick="setMood('sad')" id="m-sad" class="text-3xl grayscale hover:grayscale-0 transition">üò¢</button>
                        </div>
                    </div>
                </div>

                <textarea id="diaryBody" rows="6" class="w-full p-5 bg-slate-50 dark:bg-slate-800 rounded-2xl outline-none focus:ring-2 focus:ring-blue-500 text-lg shadow-inner" placeholder="‡∏û‡∏¥‡∏°‡∏û‡πå‡πÄ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏£‡∏≤‡∏ß‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì‡∏ó‡∏µ‡πà‡∏ô‡∏µ‡πà..."></textarea>
                
                <input id="hashtagInput" type="text" class="w-full p-2 border-b border-slate-200 dark:border-slate-700 bg-transparent outline-none font-mono text-blue-500" placeholder="#tag1 #tag2">

                <div class="bg-slate-50 dark:bg-slate-800 p-5 rounded-2xl">
                    <h3 class="font-bold mb-3 flex items-center gap-2"><i data-lucide="check-circle" class="w-4"></i> ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£ To-Do</h3>
                    <div id="todoList" class="space-y-2 mb-3"></div>
                    <div class="flex gap-2">
                        <input id="todoInput" type="text" class="flex-1 bg-white dark:bg-slate-700 p-2 rounded-xl outline-none" placeholder="‡∏ó‡∏≥‡∏≠‡∏∞‡πÑ‡∏£‡∏ï‡πà‡∏≠‡∏î‡∏µ?">
                        <button onclick="addTodo()" class="bg-blue-600 text-white px-4 rounded-xl hover:bg-blue-700 transition">‡πÄ‡∏û‡∏¥‡πà‡∏°</button>
                    </div>
                </div>

                <button onclick="saveEntry()" class="w-full bg-blue-600 text-white py-4 rounded-2xl font-bold shadow-lg shadow-blue-200 dark:shadow-none hover:bg-blue-700 transform active:scale-[0.98] transition">
                    ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÑ‡∏î‡∏≠‡∏≤‡∏£‡∏µ‡πà‡∏ß‡∏±‡∏ô‡∏ô‡∏µ‡πâ
                </button>
            </div>
        </div>
    </main>

    <script>
        // --- Configuration & Data ---
        let db = JSON.parse(localStorage.getItem('diary_ai_db')) || {};
        let viewDate = new Date();
        let activeDate = "";
        let currentMood = "";
        let currentImage = "";
        let isDarkMode = false;

        const aiQuestions = [
            "‡∏ß‡∏±‡∏ô‡∏ô‡∏µ‡πâ‡∏°‡∏µ‡πÄ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏≠‡∏∞‡πÑ‡∏£‡∏ó‡∏µ‡πà‡∏ó‡∏≥‡πÉ‡∏´‡πâ‡∏Ñ‡∏∏‡∏ì‡∏¢‡∏¥‡πâ‡∏°‡πÑ‡∏î‡πâ‡∏Å‡∏ß‡πâ‡∏≤‡∏á‡∏ó‡∏µ‡πà‡∏™‡∏∏‡∏î?",
            "‡∏ñ‡πâ‡∏≤‡∏ß‡∏±‡∏ô‡∏ô‡∏µ‡πâ‡πÄ‡∏õ‡πá‡∏ô‡∏ö‡∏ó‡∏´‡∏ô‡∏∂‡πà‡∏á‡πÉ‡∏ô‡∏´‡∏ô‡∏±‡∏á‡∏™‡∏∑‡∏≠ ‡∏ä‡∏∑‡πà‡∏≠‡∏ö‡∏ó‡∏ô‡∏µ‡πâ‡∏Ñ‡∏ß‡∏£‡∏ä‡∏∑‡πà‡∏≠‡∏ß‡πà‡∏≤‡∏≠‡∏∞‡πÑ‡∏£?",
            "‡πÉ‡∏Ñ‡∏£‡∏Ñ‡∏∑‡∏≠‡∏Ñ‡∏ô‡∏ó‡∏µ‡πà‡∏Ñ‡∏∏‡∏ì‡∏≠‡∏¢‡∏≤‡∏Å‡∏Ç‡∏≠‡∏ö‡∏Ñ‡∏∏‡∏ì‡∏°‡∏≤‡∏Å‡∏ó‡∏µ‡πà‡∏™‡∏∏‡∏î‡πÉ‡∏ô‡∏ß‡∏±‡∏ô‡∏ô‡∏µ‡πâ?",
            "‡∏ß‡∏±‡∏ô‡∏ô‡∏µ‡πâ‡∏Ñ‡∏∏‡∏ì‡πÑ‡∏î‡πâ‡πÄ‡∏≠‡∏≤‡∏ä‡∏ô‡∏∞‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ó‡πâ‡∏≤‡∏ó‡∏≤‡∏¢‡∏≠‡∏∞‡πÑ‡∏£‡∏ö‡πâ‡∏≤‡∏á‡πÑ‡∏´‡∏°?",
            "‡∏ñ‡πâ‡∏≤‡πÉ‡∏´‡πâ‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡∏∏‡∏Ç‡πÉ‡∏ô‡∏ß‡∏±‡∏ô‡∏ô‡∏µ‡πâ 1-10 ‡∏Ñ‡∏∏‡∏ì‡πÉ‡∏´‡πâ‡πÄ‡∏ó‡πà‡∏≤‡πÑ‡∏´‡∏£‡πà ‡πÄ‡∏û‡∏£‡∏≤‡∏∞‡∏≠‡∏∞‡πÑ‡∏£?",
            "‡∏°‡∏µ‡∏≠‡∏∞‡πÑ‡∏£‡∏ó‡∏µ‡πà‡∏Ñ‡∏∏‡∏ì‡∏≠‡∏¢‡∏≤‡∏Å‡∏ó‡∏≥‡πÅ‡∏ï‡πà‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡∏ó‡∏≥‡πÉ‡∏ô‡∏ß‡∏±‡∏ô‡∏ô‡∏µ‡πâ?",
            "‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡∏±‡πâ‡∏ô‡πÜ ‡∏ó‡∏µ‡πà‡∏Ñ‡∏∏‡∏ì‡∏≠‡∏¢‡∏≤‡∏Å‡∏ö‡∏≠‡∏Å‡∏ï‡∏±‡∏ß‡πÄ‡∏≠‡∏á‡πÉ‡∏ô‡∏ß‡∏±‡∏ô‡∏û‡∏£‡∏∏‡πà‡∏á‡∏ô‡∏µ‡πâ‡∏Ñ‡∏∑‡∏≠‡∏≠‡∏∞‡πÑ‡∏£?",
            "‡∏≠‡∏≤‡∏´‡∏≤‡∏£‡∏°‡∏∑‡πâ‡∏≠‡∏ó‡∏µ‡πà‡∏≠‡∏£‡πà‡∏≠‡∏¢‡∏ó‡∏µ‡πà‡∏™‡∏∏‡∏î‡∏Ç‡∏≠‡∏á‡∏ß‡∏±‡∏ô‡∏ô‡∏µ‡πâ‡∏Ñ‡∏∑‡∏≠‡∏≠‡∏∞‡πÑ‡∏£?",
            "‡∏ß‡∏±‡∏ô‡∏ô‡∏µ‡πâ‡∏Ñ‡∏∏‡∏ì‡πÑ‡∏î‡πâ‡∏ä‡πà‡∏ß‡∏¢‡πÄ‡∏´‡∏•‡∏∑‡∏≠‡πÉ‡∏Ñ‡∏£ ‡∏´‡∏£‡∏∑‡∏≠‡πÄ‡∏´‡πá‡∏ô‡πÉ‡∏Ñ‡∏£‡∏ä‡πà‡∏ß‡∏¢‡πÄ‡∏´‡∏•‡∏∑‡∏≠‡∏Å‡∏±‡∏ô‡∏ö‡πâ‡∏≤‡∏á‡πÑ‡∏´‡∏°?",
            "‡∏°‡∏µ‡πÄ‡∏™‡∏µ‡∏¢‡∏á‡∏´‡∏£‡∏∑‡∏≠‡∏Å‡∏•‡∏¥‡πà‡∏ô‡∏≠‡∏∞‡πÑ‡∏£‡∏ó‡∏µ‡πà‡∏ó‡∏≥‡πÉ‡∏´‡πâ‡∏Ñ‡∏∏‡∏ì‡∏£‡∏π‡πâ‡∏™‡∏∂‡∏Å‡∏î‡∏µ‡πÉ‡∏ô‡∏ß‡∏±‡∏ô‡∏ô‡∏µ‡πâ?",
            "‡∏Ñ‡∏∏‡∏ì‡∏ó‡∏≥‡∏≠‡∏∞‡πÑ‡∏£‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à‡πÑ‡∏õ‡πÅ‡∏•‡πâ‡∏ß‡∏ö‡πâ‡∏≤‡∏á ‡πÅ‡∏°‡πâ‡∏à‡∏∞‡πÄ‡∏õ‡πá‡∏ô‡πÄ‡∏£‡∏∑‡πà‡∏≠‡∏á‡πÄ‡∏•‡πá‡∏Å‡πÜ ‡∏Å‡πá‡∏ï‡∏≤‡∏°?",
            "‡∏Ñ‡∏ß‡∏≤‡∏°‡∏£‡∏π‡πâ‡∏™‡∏∂‡∏Å‡∏´‡∏•‡∏±‡∏Å‡πÜ ‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì‡πÉ‡∏ô‡∏ï‡∏≠‡∏ô‡∏ô‡∏µ‡πâ‡∏Ñ‡∏∑‡∏≠‡∏≠‡∏∞‡πÑ‡∏£?",
            "‡∏ß‡∏±‡∏ô‡∏ô‡∏µ‡πâ‡∏Ñ‡∏∏‡∏ì‡πÑ‡∏î‡πâ‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏£‡∏π‡πâ‡∏ö‡∏ó‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡πÉ‡∏´‡∏°‡πà‡πÜ ‡∏≠‡∏∞‡πÑ‡∏£‡∏ö‡πâ‡∏≤‡∏á?",
            "‡∏ñ‡πâ‡∏≤‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡πÄ‡∏´‡∏ï‡∏∏‡∏Å‡∏≤‡∏£‡∏ì‡πå‡∏´‡∏ô‡∏∂‡πà‡∏á‡πÉ‡∏ô‡∏ß‡∏±‡∏ô‡∏ô‡∏µ‡πâ‡πÑ‡∏î‡πâ ‡∏Ñ‡∏∏‡∏ì‡∏à‡∏∞‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏≠‡∏∞‡πÑ‡∏£?"
        ];

        function init() {
            lucide.createIcons();
            renderCalendar();
            updateChart();
        }

        // --- AI Prompt Logic (Req 1.4) ---
        function getAIQuestion(dateStr) {
            // ‡πÉ‡∏ä‡πâ‡πÄ‡∏•‡∏Ç‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏™‡∏∏‡πà‡∏°‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÉ‡∏´‡πâ‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡πÄ‡∏î‡∏¥‡∏°‡πÑ‡∏î‡πâ‡∏Ñ‡∏≥‡∏ñ‡∏≤‡∏°‡πÄ‡∏î‡∏¥‡∏°‡πÄ‡∏™‡∏°‡∏≠
            const seed = dateStr.split('-').reduce((acc, val) => acc + parseInt(val), 0);
            return aiQuestions[seed % aiQuestions.length];
        }

        // --- View Management ---
        function openEntry(date) {
            activeDate = date;
            const data = db[date] || { body: '', mood: '', tags: '', todos: [], img: '' };
            
            document.getElementById('calendar-view').classList.add('hidden');
            document.getElementById('entry-view').classList.remove('hidden');
            
            // Set Date Title
            const d = new Date(date);
            document.getElementById('entryDateTitle').innerText = d.toLocaleDateString('th-TH', { weekday: 'long', day: 'numeric', month: 'long' });
            
            // Set AI Question
            document.getElementById('aiQuestion').innerText = getAIQuestion(date);
            
            // Load Data
            document.getElementById('diaryBody').value = data.body;
            document.getElementById('hashtagInput').value = data.tags;
            currentMood = data.mood;
            currentImage = data.img;
            
            // Preview Image
            const preview = document.getElementById('imagePreview');
            preview.innerHTML = data.img ? `<img src="${data.img}" class="w-full h-full object-cover">` : '<i data-lucide="camera" class="text-slate-400"></i>';
            
            highlightMood(currentMood);
            renderTodos(data.todos || []);
            lucide.createIcons();
            window.scrollTo(0, 0);
        }

        function showCalendarView() {
            document.getElementById('calendar-view').classList.remove('hidden');
            document.getElementById('entry-view').classList.add('hidden');
            renderCalendar();
            updateChart();
        }

        // --- Calendar Render ---
        function renderCalendar(tagFilter = "") {
            const grid = document.getElementById('calendarGrid');
            grid.innerHTML = '';
            const y = viewDate.getFullYear();
            const m = viewDate.getMonth();
            document.getElementById('monthLabel').innerText = new Intl.DateTimeFormat('th-TH', {month:'long', year:'numeric'}).format(viewDate);

            ['‡∏≠‡∏≤','‡∏à','‡∏≠','‡∏û','‡∏û‡∏§','‡∏®','‡∏™'].forEach(d => grid.innerHTML += `<div class="p-2 font-bold text-slate-400">${d}</div>`);

            const firstDay = new Date(y, m, 1).getDay();
            const days = new Date(y, m + 1, 0).getDate();

            for (let i = 0; i < firstDay; i++) grid.innerHTML += `<div></div>`;

            for (let d = 1; d <= days; d++) {
                const dateKey = `${y}-${m + 1}-${d}`;
                const entry = db[dateKey];
                const isSelectedTag = tagFilter && entry?.tags.includes(tagFilter);
                const bg = entry ? (isSelectedTag ? 'bg-blue-500 text-white' : 'bg-blue-50 dark:bg-blue-900/40 text-blue-600') : 'bg-white dark:bg-slate-800';
                
                grid.innerHTML += `
                    <div onclick="openEntry('${dateKey}')" class="p-4 rounded-2xl cursor-pointer hover:ring-2 hover:ring-blue-400 transition ${bg}">
                        <div class="font-bold">${d}</div>
                        <div class="text-xs mt-1">${entry ? (entry.mood === 'happy' ? 'üòä' : entry.mood === 'neutral' ? 'üòê' : 'üò¢') : ''}</div>
                    </div>
                `;
            }
        }

        // --- Feature Functions ---
        function handleImage(e) {
            const file = e.target.files[0];
            if (file) {
                const reader = new FileReader();
                reader.onload = (event) => {
                    currentImage = event.target.result;
                    document.getElementById('imagePreview').innerHTML = `<img src="${currentImage}" class="w-full h-full object-cover">`;
                };
                reader.readAsDataURL(file);
            }
        }

        function saveEntry() {
            db[activeDate] = {
                body: document.getElementById('diaryBody').value,
                mood: currentMood,
                tags: document.getElementById('hashtagInput').value,
                img: currentImage,
                todos: Array.from(document.querySelectorAll('#todoList div')).map(el => ({
                    text: el.querySelector('span').innerText,
                    done: el.querySelector('input').checked
                })),
                updatedAt: new Date().toISOString()
            };
            localStorage.setItem('diary_ai_db', JSON.stringify(db));
            alert("‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ó‡∏£‡∏á‡∏à‡∏≥‡πÅ‡∏•‡πâ‡∏ß ‚ú®");
            showCalendarView();
        }

        function toggleDarkMode() {
            isDarkMode = !isDarkMode;
            document.documentElement.classList.toggle('dark');
            const icon = document.getElementById('darkIcon');
            icon.setAttribute('data-lucide', isDarkMode ? 'sun' : 'moon');
            lucide.createIcons();
        }

        function setMood(m) {
            currentMood = m;
            ['happy','neutral','sad'].forEach(id => {
                document.getElementById('m-'+id).classList.toggle('grayscale-0', id === m);
                document.getElementById('m-'+id).classList.toggle('scale-125', id === m);
            });
        }

        function searchByTag() { renderCalendar(document.getElementById('searchTag').value); }
        function changeMonth(n) { viewDate.setMonth(viewDate.getMonth() + n); renderCalendar(); }
        function addTodo() {
            const val = document.getElementById('todoInput').value;
            if(!val) return;
            document.getElementById('todoList').innerHTML += `<div class="flex items-center gap-2 bg-white dark:bg-slate-700 p-2 rounded-lg"><input type="checkbox"> <span class="text-sm">${val}</span></div>`;
            document.getElementById('todoInput').value = '';
        }
        function renderTodos(todos) {
            document.getElementById('todoList').innerHTML = todos.map(t => `<div class="flex items-center gap-2 bg-white dark:bg-slate-700 p-2 rounded-lg"><input type="checkbox" ${t.done?'checked':''}> <span class="text-sm">${t.text}</span></div>`).join('');
        }

        function updateChart() {
            const ctx = document.getElementById('moodChart').getContext('2d');
            if(window.myChart) window.myChart.destroy();
            window.myChart = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: ['‡∏à','‡∏≠','‡∏û','‡∏û‡∏§','‡∏®','‡∏™','‡∏≠‡∏≤'],
                    datasets: [{ label: '‡∏£‡∏∞‡∏î‡∏±‡∏ö‡∏Ñ‡∏ß‡∏≤‡∏°‡∏£‡∏π‡πâ‡∏™‡∏∂‡∏Å', data: [2, 3, 2, 1, 3, 2, 2], borderColor: '#3b82f6', tension: 0.4 }]
                },
                options: { maintainAspectRatio: false }
            });
        }

        window.onload = init;
    </script>
</body>
</html>
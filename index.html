<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Digital Diary - ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏õ‡∏£‡∏∞‡∏à‡∏≥‡∏ß‡∏±‡∏ô</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/lucide@latest"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Sarabun:wght@300;400;600&display=swap');
        body { font-family: 'Sarabun', sans-serif; }
        .active-day { background-color: #2563eb !important; color: white !important; }
    </style>
</head>
<body class="bg-gray-50">

    <nav class="bg-blue-600 text-white p-4 shadow-md">
        <div class="container mx-auto flex justify-between items-center">
            <h1 class="text-xl font-bold flex items-center gap-2">
                <i data-lucide="book-heart"></i> My Diary App
            </h1>
            <div class="text-sm">PDPA Secure Mode üîí</div>
        </div>
    </nav>

    <div class="container mx-auto p-4 grid grid-cols-1 md:grid-cols-3 gap-6">
        
        <div class="bg-white p-5 rounded-xl shadow-sm border">
            <div class="flex justify-between items-center mb-4">
                <h2 id="monthLabel" class="font-bold text-lg"></h2>
                <div class="flex gap-2">
                    <button onclick="changeMonth(-1)" class="p-1 border rounded">‚óÄ</button>
                    <button onclick="changeMonth(1)" class="p-1 border rounded">‚ñ∂</button>
                </div>
            </div>
            <div class="grid grid-cols-7 gap-1 text-center text-xs font-bold mb-2">
                <div>‡∏≠‡∏≤</div><div>‡∏à</div><div>‡∏≠</div><div>‡∏û</div><div>‡∏û‡∏§</div><div>‡∏®</div><div>‡∏™</div>
            </div>
            <div id="calendarGrid" class="grid grid-cols-7 gap-1 text-sm"></div>
            
            <div class="mt-8">
                <h3 class="font-bold mb-2 text-sm">‡∏™‡∏ñ‡∏¥‡∏ï‡∏¥‡∏≠‡∏≤‡∏£‡∏°‡∏ì‡πå‡∏™‡∏±‡∏õ‡∏î‡∏≤‡∏´‡πå‡∏ô‡∏µ‡πâ</h3>
                <canvas id="moodChart" height="150"></canvas>
            </div>
        </div>

        <div class="md:col-span-2 space-y-4">
            <div class="bg-white p-6 rounded-xl shadow-sm border">
                <h2 id="selectedDateTitle" class="text-xl font-bold mb-2 text-blue-600"></h2>
                
                <div class="mb-4">
                    <p class="text-sm text-gray-500 mb-2 italic" id="aiPrompt">AI: ‡∏ß‡∏±‡∏ô‡∏ô‡∏µ‡πâ‡∏°‡∏µ‡πÄ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏≠‡∏∞‡πÑ‡∏£‡∏ó‡∏µ‡πà‡∏ó‡∏≥‡πÉ‡∏´‡πâ‡∏Ñ‡∏∏‡∏ì‡∏¢‡∏¥‡πâ‡∏°‡πÑ‡∏î‡πâ‡∏ö‡πâ‡∏≤‡∏á?</p>
                    <label class="block text-sm font-bold mb-1">‡∏Ñ‡∏ß‡∏≤‡∏°‡∏£‡∏π‡πâ‡∏™‡∏∂‡∏Å‡∏ß‡∏±‡∏ô‡∏ô‡∏µ‡πâ:</label>
                    <div class="flex gap-4" id="moodSelector">
                        <button onclick="setMood('happy')" class="text-2xl p-2 rounded hover:bg-yellow-100" id="m-happy">üòä</button>
                        <button onclick="setMood('neutral')" class="text-2xl p-2 rounded hover:bg-gray-100" id="m-neutral">üòê</button>
                        <button onclick="setMood('sad')" class="text-2xl p-2 rounded hover:bg-blue-100" id="m-sad">üò¢</button>
                    </div>
                </div>

                <textarea id="diaryEntry" rows="6" class="w-full p-4 border rounded-lg mb-2 focus:ring-2 focus:ring-blue-400 outline-none" placeholder="‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÄ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏£‡∏≤‡∏ß‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì..."></textarea>
                <input id="hashtagInput" type="text" class="w-full p-2 border-b mb-4 outline-none" placeholder="#‡πÅ‡∏Æ‡∏ä‡πÅ‡∏ó‡πá‡∏Å ‡πÄ‡∏ä‡πà‡∏ô #‡∏ó‡∏≥‡∏á‡∏≤‡∏ô #‡∏≠‡∏£‡πà‡∏≠‡∏¢">

                <div class="border-t pt-4">
                    <h3 class="font-bold mb-2">‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£ To-Do:</h3>
                    <div id="todoContainer" class="space-y-2 mb-4 text-sm"></div>
                    <div class="flex gap-2">
                        <input id="newTodo" type="text" class="flex-1 border p-2 rounded" placeholder="‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏á‡∏≤‡∏ô...">
                        <button onclick="addTodoItem()" class="bg-green-500 text-white px-4 py-2 rounded">‡πÄ‡∏û‡∏¥‡πà‡∏°</button>
                    </div>
                </div>

                <div class="mt-6 flex gap-2">
                    <button onclick="saveToLocal()" class="bg-blue-600 text-white px-8 py-3 rounded-lg font-bold hover:bg-blue-700 w-full">‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</button>
                    <button onclick="downloadData()" class="border px-4 py-2 rounded-lg text-sm">‡∏™‡πà‡∏á‡∏≠‡∏≠‡∏Å JSON</button>
                </div>
            </div>
        </div>
    </div>

    <script>
        // --- ‡∏™‡πà‡∏ß‡∏ô‡∏Ñ‡∏ß‡∏ö‡∏Ñ‡∏∏‡∏°‡∏£‡∏∞‡∏ö‡∏ö (Logic) ---
        let storage = JSON.parse(localStorage.getItem('diary_app_db')) || {};
        let currentMonth = new Date().getMonth();
        let currentYear = new Date().getFullYear();
        let selectedDate = new Date().toISOString().split('T')[0];
        let currentMood = '';

        function init() {
            lucide.createIcons();
            renderCalendar();
            loadDate(selectedDate);
            updateChart();
        }

        function renderCalendar() {
            const grid = document.getElementById('calendarGrid');
            grid.innerHTML = '';
            const firstDay = new Date(currentYear, currentMonth, 1).getDay();
            const daysInMonth = new Date(currentYear, currentMonth + 1, 0).getDate();
            const monthNames = ["‡∏°‡∏Å‡∏£‡∏≤‡∏Ñ‡∏°", "‡∏Å‡∏∏‡∏°‡∏†‡∏≤‡∏û‡∏±‡∏ô‡∏ò‡πå", "‡∏°‡∏µ‡∏ô‡∏≤‡∏Ñ‡∏°", "‡πÄ‡∏°‡∏©‡∏≤‡∏¢‡∏ô", "‡∏û‡∏§‡∏©‡∏†‡∏≤‡∏Ñ‡∏°", "‡∏°‡∏¥‡∏ñ‡∏∏‡∏ô‡∏≤‡∏¢‡∏ô", "‡∏Å‡∏£‡∏Å‡∏é‡∏≤‡∏Ñ‡∏°", "‡∏™‡∏¥‡∏á‡∏´‡∏≤‡∏Ñ‡∏°", "‡∏Å‡∏±‡∏ô‡∏¢‡∏≤‡∏¢‡∏ô", "‡∏ï‡∏∏‡∏•‡∏≤‡∏Ñ‡∏°", "‡∏û‡∏§‡∏®‡∏à‡∏¥‡∏Å‡∏≤‡∏¢‡∏ô", "‡∏ò‡∏±‡∏ô‡∏ß‡∏≤‡∏Ñ‡∏°"];
            
            document.getElementById('monthLabel').innerText = `${monthNames[currentMonth]} ${currentYear + 543}`;

            for (let i = 0; i < firstDay; i++) grid.innerHTML += `<div></div>`;
            for (let d = 1; d <= daysInMonth; d++) {
                const dStr = `${currentYear}-${String(currentMonth+1).padStart(2,'0')}-${String(d).padStart(2,'0')}`;
                const active = dStr === selectedDate ? 'active-day shadow-md' : 'hover:bg-blue-50';
                grid.innerHTML += `<button onclick="loadDate('${dStr}')" class="p-2 rounded-lg ${active}">${d}</button>`;
            }
        }

        function loadDate(date) {
            selectedDate = date;
            const data = storage[date] || { text: '', mood: '', tags: '', todos: [] };
            document.getElementById('diaryEntry').value = data.text;
            document.getElementById('hashtagInput').value = data.tags;
            document.getElementById('selectedDateTitle').innerText = `‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà ${new Date(date).toLocaleDateString('th-TH')}`;
            currentMood = data.mood;
            renderTodos(data.todos || []);
            renderCalendar();
        }

        function saveToLocal() {
            if (!storage[selectedDate]) storage[selectedDate] = {};
            storage[selectedDate].text = document.getElementById('diaryEntry').value;
            storage[selectedDate].tags = document.getElementById('hashtagInput').value;
            storage[selectedDate].mood = currentMood;
            localStorage.setItem('diary_app_db', JSON.stringify(storage));
            updateChart();
            alert('‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏•‡∏á‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢‡πÅ‡∏•‡πâ‡∏ß');
        }

        function setMood(m) {
            currentMood = m;
            document.querySelectorAll('#moodSelector button').forEach(b => b.classList.remove('bg-blue-100', 'ring-2'));
            document.getElementById('m-'+m).classList.add('bg-blue-100', 'ring-2', 'ring-blue-400');
        }

        function renderTodos(todos) {
            const container = document.getElementById('todoContainer');
            container.innerHTML = todos.map((t, i) => `
                <div class="flex items-center gap-2 bg-gray-50 p-2 rounded">
                    <input type="checkbox" ${t.done ? 'checked' : ''} onchange="toggleTodo(${i})">
                    <span class="${t.done ? 'line-through text-gray-400' : ''}">${t.text}</span>
                </div>
            `).join('');
            if(!storage[selectedDate]) storage[selectedDate] = { todos: [] };
            storage[selectedDate].todos = todos;
        }

        function addTodoItem() {
            const input = document.getElementById('newTodo');
            if(!input.value) return;
            const currentTodos = storage[selectedDate]?.todos || [];
            currentTodos.push({ text: input.value, done: false });
            renderTodos(currentTodos);
            input.value = '';
        }

        function toggleTodo(i) {
            storage[selectedDate].todos[i].done = !storage[selectedDate].todos[i].done;
            renderTodos(storage[selectedDate].todos);
        }

        function changeMonth(n) {
            currentMonth += n;
            if(currentMonth > 11) { currentMonth = 0; currentYear++; }
            if(currentMonth < 0) { currentMonth = 11; currentYear--; }
            renderCalendar();
        }

        function updateChart() {
            const ctx = document.getElementById('moodChart').getContext('2d');
            const data = [1, 2, 1, 3, 2, 1, 2]; // ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏à‡∏≥‡∏•‡∏≠‡∏á
            if(window.myChart) window.myChart.destroy();
            window.myChart = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: ['‡∏à', '‡∏≠', '‡∏û', '‡∏û‡∏§', '‡∏®', '‡∏™', '‡∏≠‡∏≤'],
                    datasets: [{ label: '‡∏£‡∏∞‡∏î‡∏±‡∏ö‡∏≠‡∏≤‡∏£‡∏°‡∏ì‡πå', data: data, borderColor: '#2563eb', tension: 0.3 }]
                },
                options: { scales: { y: { display: false } } }
            });
        }

        function downloadData() {
            const data = "data:text/json;charset=utf-8," + encodeURIComponent(JSON.stringify(storage));
            const link = document.createElement('a');
            link.setAttribute("href", data);
            link.setAttribute("download", "diary_backup.json");
            link.click();
        }

        window.onload = init;
    </script>
</body>
</html>
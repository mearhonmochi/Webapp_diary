<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>My Diary Calendar</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/lucide@latest"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Sarabun:wght@300;400;600&display=swap');
        body { font-family: 'Sarabun', sans-serif; background-color: #f9fafb; }
        .calendar-card { min-height: 100px; transition: 0.2s; }
        .has-entry::after { content: '‚Ä¢'; color: #3b82f6; font-size: 24px; display: block; line-height: 0; }
        .hidden { display: none; }
    </style>
</head>
<body>

    <nav class="bg-white border-b p-4 mb-4">
        <div class="container mx-auto flex justify-between items-center">
            <h1 class="text-xl font-bold text-blue-600 flex items-center gap-2 cursor-pointer" onclick="showCalendarView()">
                <i data-lucide="calendar"></i> Diary Calendar
            </h1>
            <div id="nav-actions" class="flex gap-2">
                <button onclick="downloadBackup()" class="text-xs bg-gray-100 p-2 rounded">‡∏™‡∏≥‡∏£‡∏≠‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</button>
            </div>
        </div>
    </nav>

    <main class="container mx-auto px-4">
        
        <div id="calendar-view" class="space-y-6">
            <div class="flex justify-between items-center bg-white p-6 rounded-2xl shadow-sm">
                <button onclick="changeMonth(-1)" class="p-2 hover:bg-gray-100 rounded-full"><i data-lucide="chevron-left"></i></button>
                <h2 id="monthYearLabel" class="text-2xl font-bold text-gray-700"></h2>
                <button onclick="changeMonth(1)" class="p-2 hover:bg-gray-100 rounded-full"><i data-lucide="chevron-right"></i></button>
            </div>

            <div class="grid grid-cols-7 gap-2">
                <div class="text-center font-bold text-red-500 p-2">‡∏≠‡∏≤</div>
                <div class="text-center font-bold text-gray-500 p-2">‡∏à</div>
                <div class="text-center font-bold text-gray-500 p-2">‡∏≠</div>
                <div class="text-center font-bold text-gray-500 p-2">‡∏û</div>
                <div class="text-center font-bold text-gray-500 p-2">‡∏û‡∏§</div>
                <div class="text-center font-bold text-gray-500 p-2">‡∏®</div>
                <div class="text-center font-bold text-blue-500 p-2">‡∏™</div>
            </div>
            
            <div id="calendarDays" class="grid grid-cols-7 gap-2">
                </div>
        </div>

        <div id="entry-view" class="hidden max-w-2xl mx-auto">
            <button onclick="showCalendarView()" class="mb-4 flex items-center gap-2 text-blue-600 hover:underline">
                <i data-lucide="arrow-left" class="w-4"></i> ‡∏Å‡∏•‡∏±‡∏ö‡πÑ‡∏õ‡∏´‡∏ô‡πâ‡∏≤‡∏õ‡∏è‡∏¥‡∏ó‡∏¥‡∏ô
            </button>
            
            <div class="bg-white p-8 rounded-3xl shadow-xl border border-gray-100">
                <h2 id="viewingDateText" class="text-2xl font-bold mb-6 text-gray-800 border-b pb-4"></h2>
                
                <div class="space-y-6">
                    <div>
                        <label class="block text-sm font-semibold text-gray-600 mb-3">‡∏ß‡∏±‡∏ô‡∏ô‡∏µ‡πâ‡∏Ñ‡∏∏‡∏ì‡∏£‡∏π‡πâ‡∏™‡∏∂‡∏Å‡∏≠‡∏¢‡πà‡∏≤‡∏á‡πÑ‡∏£?</label>
                        <div class="flex justify-between bg-gray-50 p-4 rounded-2xl" id="moodPicker">
                            <button onclick="setMood('happy')" id="btn-happy" class="text-3xl p-2 rounded-xl hover:bg-white hover:shadow-sm transition">üòä</button>
                            <button onclick="setMood('neutral')" id="btn-neutral" class="text-3xl p-2 rounded-xl hover:bg-white hover:shadow-sm transition">üòê</button>
                            <button onclick="setMood('sad')" id="btn-sad" class="text-3xl p-2 rounded-xl hover:bg-white hover:shadow-sm transition">üò¢</button>
                            <button onclick="setMood('angry')" id="btn-angry" class="text-3xl p-2 rounded-xl hover:bg-white hover:shadow-sm transition">üò°</button>
                        </div>
                    </div>

                    <div>
                        <label class="block text-sm font-semibold text-gray-600 mb-2">‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÄ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏£‡∏≤‡∏ß</label>
                        <textarea id="diaryBody" rows="8" class="w-full p-4 bg-gray-50 border-none rounded-2xl focus:ring-2 focus:ring-blue-400 outline-none" placeholder="‡πÄ‡∏Ç‡∏µ‡∏¢‡∏ô‡πÄ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏£‡∏≤‡∏ß‡∏ó‡∏µ‡πà‡∏ô‡πà‡∏≤‡∏à‡∏î‡∏à‡∏≥‡∏Ç‡∏≠‡∏á‡∏ß‡∏±‡∏ô‡∏ô‡∏µ‡πâ..."></textarea>
                    </div>

                    <div>
                        <input id="tagInput" type="text" class="w-full p-2 border-b border-gray-100 outline-none italic text-sm" placeholder="#‡∏ï‡∏¥‡∏î‡πÅ‡∏ó‡πá‡∏Å ‡πÄ‡∏ä‡πà‡∏ô #‡πÄ‡∏ó‡∏µ‡πà‡∏¢‡∏ß #‡∏ó‡∏≥‡∏á‡∏≤‡∏ô">
                    </div>

                    <button onclick="saveEntry()" class="w-full bg-blue-600 text-white py-4 rounded-2xl font-bold text-lg hover:bg-blue-700 shadow-lg shadow-blue-200 transition">‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÑ‡∏î‡∏≠‡∏≤‡∏£‡∏µ‡πà</button>
                </div>
            </div>
        </div>

    </main>

    <script>
        // Data Store
        let diaryDB = JSON.parse(localStorage.getItem('diary_master_db')) || {};
        let viewDate = new Date(); // ‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏ó‡∏µ‡πà‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏î‡∏π‡πÉ‡∏ô‡∏õ‡∏è‡∏¥‡∏ó‡∏¥‡∏ô
        let activeEntryDate = ""; // ‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏ó‡∏µ‡πà‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÄ‡∏Ç‡∏µ‡∏¢‡∏ô‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å
        let selectedMood = "";

        function init() {
            lucide.createIcons();
            renderCalendar();
        }

        // 1. ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏õ‡∏è‡∏¥‡∏ó‡∏¥‡∏ô
        function renderCalendar() {
            const grid = document.getElementById('calendarDays');
            const label = document.getElementById('monthYearLabel');
            grid.innerHTML = '';

            const year = viewDate.getFullYear();
            const month = viewDate.getMonth();
            
            const monthNames = ["‡∏°‡∏Å‡∏£‡∏≤‡∏Ñ‡∏°", "‡∏Å‡∏∏‡∏°‡∏†‡∏≤‡∏û‡∏±‡∏ô‡∏ò‡πå", "‡∏°‡∏µ‡∏ô‡∏≤‡∏Ñ‡∏°", "‡πÄ‡∏°‡∏©‡∏≤‡∏¢‡∏ô", "‡∏û‡∏§‡∏©‡∏†‡∏≤‡∏Ñ‡∏°", "‡∏°‡∏¥‡∏ñ‡∏∏‡∏ô‡∏≤‡∏¢‡∏ô", "‡∏Å‡∏£‡∏Å‡∏é‡∏≤‡∏Ñ‡∏°", "‡∏™‡∏¥‡∏á‡∏´‡∏≤‡∏Ñ‡∏°", "‡∏Å‡∏±‡∏ô‡∏¢‡∏≤‡∏¢‡∏ô", "‡∏ï‡∏∏‡∏•‡∏≤‡∏Ñ‡∏°", "‡∏û‡∏§‡∏®‡∏à‡∏¥‡∏Å‡∏≤‡∏¢‡∏ô", "‡∏ò‡∏±‡∏ô‡∏ß‡∏≤‡∏Ñ‡∏°"];
            label.innerText = `${monthNames[month]} ${year + 543}`;

            const firstDay = new Date(year, month, 1).getDay();
            const daysInMonth = new Date(year, month + 1, 0).getDate();

            // ‡πÄ‡∏ï‡∏¥‡∏°‡∏ä‡πà‡∏≠‡∏á‡∏ß‡πà‡∏≤‡∏á‡∏ß‡∏±‡∏ô‡∏Å‡πà‡∏≠‡∏ô‡∏´‡∏ô‡πâ‡∏≤
            for (let i = 0; i < firstDay; i++) {
                grid.innerHTML += `<div class="p-4"></div>`;
            }

            // ‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏ä‡πà‡∏≠‡∏á‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà
            for (let d = 1; d <= daysInMonth; d++) {
                const dateKey = `${year}-${String(month + 1).padStart(2, '0')}-${String(d).padStart(2, '0')}`;
                const hasEntry = diaryDB[dateKey] ? 'has-entry' : '';
                const isToday = new Date().toDateString() === new Date(year, month, d).toDateString() ? 'bg-blue-50 border-blue-200' : 'bg-white border-gray-100';

                grid.innerHTML += `
                    <div onclick="openEntry('${dateKey}')" 
                         class="calendar-card ${isToday} border-2 rounded-2xl p-4 cursor-pointer hover:border-blue-400 hover:shadow-md text-center flex flex-col items-center justify-center gap-1 ${hasEntry}">
                        <span class="text-lg font-semibold">${d}</span>
                        <span class="text-xs text-gray-400">${diaryDB[dateKey]?.mood || ''}</span>
                    </div>
                `;
            }
        }

        // 2. ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏™‡∏•‡∏±‡∏ö‡∏´‡∏ô‡πâ‡∏≤‡∏à‡∏≠ (Views)
        function openEntry(date) {
            activeEntryDate = date;
            document.getElementById('calendar-view').classList.add('hidden');
            document.getElementById('entry-view').classList.remove('hidden');
            
            const dateObj = new Date(date);
            document.getElementById('viewingDateText').innerText = dateObj.toLocaleDateString('th-TH', { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' });
            
            // ‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏Å‡πà‡∏≤ (‡∏ñ‡πâ‡∏≤‡∏°‡∏µ)
            const entry = diaryDB[date] || { body: '', mood: '', tags: '' };
            document.getElementById('diaryBody').value = entry.body;
            document.getElementById('tagInput').value = entry.tags;
            setMood(entry.mood);
        }

        function showCalendarView() {
            document.getElementById('calendar-view').classList.remove('hidden');
            document.getElementById('entry-view').classList.add('hidden');
            renderCalendar();
        }

        // 3. ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•
        function setMood(m) {
            selectedMood = m;
            const moods = ['happy', 'neutral', 'sad', 'angry'];
            moods.forEach(id => {
                document.getElementById('btn-' + id).classList.remove('bg-white', 'shadow-md', 'ring-2', 'ring-blue-400');
            });
            if(m) {
                document.getElementById('btn-' + m).classList.add('bg-white', 'shadow-md', 'ring-2', 'ring-blue-400');
            }
        }

        function saveEntry() {
            const body = document.getElementById('diaryBody').value;
            const tags = document.getElementById('tagInput').value;

            if (!body && !selectedMood) {
                alert("‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏´‡∏£‡∏∑‡∏≠‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏≠‡∏≤‡∏£‡∏°‡∏ì‡πå‡∏Å‡πà‡∏≠‡∏ô‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ñ‡πà‡∏∞");
                return;
            }

            diaryDB[activeEntryDate] = {
                body: body,
                mood: selectedMood,
                tags: tags,
                updatedAt: new Date().toISOString()
            };

            localStorage.setItem('diary_master_db', JSON.stringify(diaryDB));
            alert("‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ó‡∏£‡∏á‡∏à‡∏≥‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢‡πÅ‡∏•‡πâ‡∏ß ‚ú®");
            showCalendarView();
        }

        function changeMonth(dir) {
            viewDate.setMonth(viewDate.getMonth() + dir);
            renderCalendar();
        }

        function downloadBackup() {
            const dataStr = "data:text/json;charset=utf-8," + encodeURIComponent(JSON.stringify(diaryDB));
            const dlAnchorElem = document.createElement('a');
            dlAnchorElem.setAttribute("href", dataStr);
            dlAnchorElem.setAttribute("download", "diary_backup.json");
            dlAnchorElem.click();
        }

        window.onload = init;
    </script>
</body>
</html>